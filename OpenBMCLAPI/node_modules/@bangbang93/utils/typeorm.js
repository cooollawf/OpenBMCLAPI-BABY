"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withTransaction = void 0;
/**
 * withTransaction for typeorm
 * @param fn
 * @param connection
 * @param qr
 * @param mode
 */
async function withTransaction(fn, connection, qr, mode) {
    if (qr) {
        return fn(qr);
    }
    qr = connection.createQueryRunner(mode);
    await qr.connect();
    await qr.startTransaction();
    try {
        const ret = await fn(qr);
        await qr.commitTransaction();
        return ret;
    }
    catch (e) {
        await qr.rollbackTransaction();
        throw e;
    }
    finally {
        await qr.release();
    }
}
exports.withTransaction = withTransaction;
//# sourceMappingURL=typeorm.js.map